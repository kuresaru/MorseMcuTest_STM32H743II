#include "morse.h"

// 摩斯码状态机

const uint8_t morse_code[42][3] = {
    // start dit dam
    {'\0', 1, 2}, // 0
    // 1 code
    {'E', 3, 4}, // 1
    {'T', 5, 6}, // 2
    // 2 code
    {'I', 7, 8},   // 3
    {'A', 9, 10},  // 4
    {'N', 11, 12}, // 5
    {'M', 13, 14}, // 6
    // 3 code
    {'S', 15, 16}, // 7
    {'U', 17, 18}, // 8
    {'R', 19, 20}, // 9
    {'W', 21, 22}, // 10
    {'D', 23, 24}, // 11
    {'K', 25, 26}, // 12
    {'G', 27, 28}, // 13
    {'O', 29, 30}, // 14
    // 4 code
    {'H', 31, 32}, // 15
    {'V', 41, 33}, // 16
    {'F', 41, 41}, // 17
    {'-', 41, 34}, // 18
    {'L', 41, 41}, // 19
    {'/', 41, 41}, // 20
    {'P', 41, 41}, // 21
    {'J', 41, 35}, // 22
    {'B', 36, 41}, // 23
    {'X', 41, 41}, // 24
    {'C', 41, 41}, // 25
    {'Y', 41, 41}, // 26
    {'Z', 37, 41}, // 27
    {'Q', 41, 41}, // 28
    {'.', 38, 41}, // 29
    {'=', 39, 40}, // 30
    // 5 code
    {'5', 41, 41}, // 31
    {'4', 41, 41}, // 32
    {'3', 41, 41}, // 33
    {'2', 41, 41}, // 34
    {'1', 41, 41}, // 35
    {'6', 41, 41}, // 36
    {'7', 41, 41}, // 37
    {'8', 41, 41}, // 38
    {'9', 41, 41}, // 39
    {'0', 41, 41}, // 40
    // error
    {'\0', 41, 41}, // 41
};

void morse_rst(morse_t *m)
{
    *m = 0;
}

void morse_dit(morse_t *m)
{
    *m = morse_code[*m][1];
}

void morse_dam(morse_t *m)
{
    *m = morse_code[*m][2];
}

char morse_get(morse_t *m)
{
    return morse_code[*m][0];
}